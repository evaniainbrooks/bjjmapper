= content_for(:title) do
  = "#{location.title} #{"BJJ" unless location.title.end_with?("BJJ")} academy in #{location.city}, #{location.country}"

.container.show-location.page{ class: moved? || closed? ? 'moved' : (closed? ? 'closed' : '') }
  %div#fb-root
  = form_for(location, html: { class: 'form ' + edit_mode_classes }) do |f|
    .row
      .col-md-10.hidden-xs
        = render partial: 'breadcrumb', locals: { location: location }
      .col-md-2.pull-right
        = render partial: 'edit_controls', locals: { location: location }
    .row
      .col-md-12
        = render partial: 'verify_message' if verified?
        = render partial: 'create_message' if created?
        = render partial: 'edit_success_message' if edit_success?
        = render partial: 'review_message' if reviewed?
        = render partial: 'schedule_timezone_missing_message' if location.timezone.blank?
        = render partial: 'closed_message' if closed? || moved?
    .row
      .col-md-11.col-md-offset-1.hidden-xs
        = render partial: 'subnav', :locals => { location: location }
    .row
      .col-md-2.col-xs-3{:style => 'padding-right: 0px;'}
        .display-field
          %img{:src => location.image, :class => 'logo center-block'}/
        .edit-field
          %img{:src => location.image, :class => 'logo center-block edit-image'}/
        = render partial: 'rating', :locals => { location: location }
        = render partial: 'favorite_button', :locals => { location: location }
        %br/
        %div.small.text-muted.text-center= "last updated #{location.updated_at}"
      .col-md-6.col-xs-9
        = render partial: 'show_header', :locals => { location: location, f: f }
      .col-md-12.hidden-lg.hidden-md.clear
        %hr/
      = render partial: 'show_contact', :locals => { location: location, f: f }
    %hr/
    .row
      .col-md-3
        %h3 Location
        %a{:name => 'location'}
        = render partial: 'show_address', locals: { location: location, f: f }
      .col-md-5
        %div.map-canvas{:style => 'height: 300px'}
        -# This is filled in by google maps
        %p.edit-field.text-info.small Note: you can drag the marker to a new location to change the address of this academy.
      .col-md-4
        %div.nearby-locations
          -# This is filled in by locations/nearby template
          .content
            %h3 Nearby Academies
            %ul.list-unstyled.items
          .alternative
            = render partial: 'application/google_adsense'

          - more_schools = [location.city, location.state || location.country].compact.join(', ')
          = link_to map_path(ref: 'loc_dp', location: more_schools), title: "Brazilian Jiu-Jitsu schools in #{more_schools}" do
            %p See more Brazilian Jiu-Jitsu schools in #{more_schools}

    %hr/
    .row
      .col-md-4.instructors
        %h3.pull-left Instructors
        %a{:name => 'instructor'}
        %button.pull-right.edit-field.btn.btn-small.btn-default.add-instructor{:style => 'margin-top: -5px', :type => 'button'}
          %i.fa.fa-plus-circle
          Add Instructor
        .clear.items
        .empty-message
          %i.text-muted We don't know who teaches at this academy
        %br/
        -#= render :partial => 'locations/instructors', :locals => { :location => location }
      .col-md-8
        %h3.pull-left
          %span.fa.fa-calendar
          Schedule
          %span.small
            = surround '(', ')' do
              = link_to 'view full schedule', schedule_location_path(location, ref: 'loc_sched_full')
        %div.pull-right.small.text-muted= "last updated #{location.schedule_updated_at}"
        %a.clear-fix.clear{:name => 'schedule'}
        .scheduler-container.clear
          .scheduler
    %hr/
    .row
      - if location.facebook.present? && !location.facebook_group?
        .col-md-5
          = render :partial => 'locations/show_news_feed', :locals => { :location => location }
      %div{:class => location.facebook.present? && !location.facebook_group? ? 'col-md-7' : 'col-md-12'}
        = render :partial => 'locations/show_media', :locals => { :f => f, :hashtag => location.ig_hashtag }
    %hr/
    .row.reviews
      .col-md-12
        = render :partial => 'locations/show_reviews', :locals => { :location => location }
    %hr.edit-field/
    .row.edit-field
      .col-md-12
        .pull-right
          %button.show-metadata.btn.btn-default.btn-md{:type => 'button'}
            %i.fa.fa-info-circle
            Show Metadata

          &nbsp;&nbsp;
          %button.delete-field.btn.btn-danger.btn-md{:type => 'button',
            :data => { :method => :delete,
                       :url => location_path(location),
                       :title => 'Are you sure you want to delete this academy?',
                       :body => "You are performing this action as <b>#{current_user.try(:name)}</b>. Press 'Confirm' to permanently delete this academy. Note that this action cannot be un-done." } }
            %i.fa.fa-trash
            Delete Academy
    %br/

  = render :partial => 'instructors/add_instructor_dialog'
  = render :partial => 'reviews/add_review_dialog'
  = render :partial => 'location_events/create_event_modal', locals: { location: location }
  = render :partial => 'location_events/move_event_modal', locals: { location: location }
  = render :partial => 'claim_location_dialog', locals: { location: location }
  = render :partial => 'metadata_dialog', locals: { location: location }
= content_for(:scripts) do
  :coffeescript
    $(document).ready ->
      mapView = new RollFindr.Views.LocationShowView({ editable: #{edit_mode?}, model: #{render_json(location)}, mapModel: #{render_json(@map)}, el: $('.show-location')})

= content_for(:scripts) do
  = render partial: 'facebook_sdk'

= content_for(:head) do
  = render partial: 'opengraph_tags', locals: { location: location }

